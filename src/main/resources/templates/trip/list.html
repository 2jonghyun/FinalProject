<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>여행지 목록</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<style type="text/css">
	* {
		padding: 0;
		margin: 0;
	}

	article{
		width: 80%;
		margin: auto;
	}
	.btn{
		float: right;
		margin-top: 30px;
		margin-bottom: 10px;
		margin-right: 10px;
	}
	.searchContainer{
		display: flex;
	}
	.select{
		font-size: 14pt;
		font-weight: bold;
	}
	.card{
		margin-bottom: 20px;
		max-height: 350px;
	}
	img{
		height: 180px;
	}
	
	/*페이징*/	
	#page_container{
		width: 80%;
		margin: auto;
		margin-bottom: 20px;
	}

	#page{
		width: 10%;
		margin: auto;
		padding-top: 10px;
		padding-bottom: 10px;
	}

	a{
		text-decoration: none;
		color: black;
		font-size: large;
	}
	
	#orderColumnContainer{
		width: 285px;
    	float: right;
    	margin-top: 15px;
	}
	
	/* 지역명 목록 */
	.koreaBtn {
		display: block;
	    position: relative;
	    float: left;
	    width: 62.4px;
	    height: 35px;
	    padding: 0;
	    margin: 5px 1px 0px 0px;
	    font-weight: 600;
	    text-align: center;
	    line-height: 50px;
	    color: #FFF;
	    border-radius: 5px;
	    transition: all 0.2s;
	    border: 0;
	    line-height: 32px;
	}
	.koreaBtn {
	  background: #5DC8CD;
	}
	.koreaBtn:hover {
	  background: #01939A;
	}

</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script type="text/javascript">
	$(function(){
		var login = $("#login_user").val();

		// 해당 아이디가 찜한 게시물 표시
		function getUserLiked(login){
			var tripLikedNoList = new Array();
			var tripLikedNoList2 = new Array();
			
			$.ajax({
				url:"/trip/findAllTripLiked/"+login,
				success:function(tripLikedNoList){
					if(tripLikedNoList != null){
						console.log(tripLikedNoList);
						/* tripLikedNoList = tripLikedNoList; */
						console.log("찜번호리스트",tripLikedNoList);
						
						for(i=0; i<tripLikedNoList.length; i++){
							tripLikedNoList2.push(tripLikedNoList[i]);
						}
						
					}
					
					console.log("함수 밖, 찜 리스트",tripLikedNoList.length);
					
					function isSelect(no){
						re = false;
						console.log("isSelect() 동작함");
						console.log(tripLikedNoList2.length);
						for(i=0; i<tripLikedNoList2.length; i++){
							console.log("isSelect()");
							if(tripLikedNoList2[i] == no){
								console.log("isSelect 함수 안,"+tripLikedNoList2);
								re = true;
								break;
							}
						}
						return re;
					};
					
					$(".tripLiked").each(function(){
						console.log("tripLiked each 동작");
						var checkLikedNoAttr = $(this).attr("checkLikedNo");
						var checkLikedNo = $(this).val();
						console.log("isSelect()전"+checkLikedNo);
						console.log("isSelect()전"+tripLikedNoList2);
						if(isSelect(checkLikedNoAttr)){
							console.log("isSelect()후"+checkLikedNo);
							console.log("checkLikedNoAttr"+checkLikedNoAttr);
							$(this).attr("checked","checked");
						}
					});
				}
			});
		};
		
		getUserLiked(login);
		
		// 찜 기능
		$(".tripLiked").click(function(){
			if($(this).is(":checked")){
				$.ajax({
					url:"/trip/tripLiked",
					data:{
						"memberId":"admin12",
						"type":"trip",
						"no": $(this).val(),
						"likeImg":$(this).attr("likeImg"),
						"likedTitle": $(this).attr("likedTitle")
					},
					success:function(re){
						if(re == 1){
							alert("찜!!");
						}
					}
				});
			}

			if($(this).is(":checked")==false){
				$.ajax({
					url:"/trip/tripUnliked",
					data:{
						"memberId":"admin12",
						"type":"trip",
						"no": $(this).val(),
						"likeImg":$(this).attr("likeImg"),
						"likedTitle": $(this).attr("likedTitle")
					},
					success:function(re){
						if(re == 1){
							alert("찜취소!!");
						}
					}
				});
			}
		});

		/* koreaBtn 눌렀을 때, css 적용 */
		/* $(".koreaBtn").click(function(){
			if($(this).)
			$(this).css({"background":"#01939A"});
		}); */
	});
</script>
</head>
<body>
	<header>
	
	</header>
	
	<h1>여행지 목록</h1>
	<hr>
	로그인한 유저 : <input type="text" name="login_user" id="login_user" value="admin12">
	<hr>
	<!-- 관리자일 때, 등록 버튼 보이게 -->
	<div th:if="${grade} == 'admin'">
		<a th:text="등록" th:href="@{|/trip/insert|}"></a>
	</div>
	<hr>
	<article style="margin-top: 50px;">
		<!-- 배너 이미지 -->
		<div style="height: 400px;">
			<img src="/images/main_seoul.png" style="width:100%; height:100%;">
		</div>
		<!-- 지역별 버튼 -->
		<div style="width: 100%">
			<div th:each="k:${koreaList}" style="width: 100%; height: auto; margin:auto;">
				<button th:text="${k.region}" th:value="${k.code}" 
						th:onclick="|location.href='@{|/trip/list?region=${k.code}|}'|" class="koreaBtn"></button>
			</div>
		</div>
		<div class="searchContainer" style="height: auto; width: 100%; float: left; margin-top:5px">
			<div style=" width: 100%;">
				<svg xmlns="http://www.w3.org/2000/svg" width="25" height="30" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" style="float:left;clear:both;margin: 10px 0 0 0;">
				  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
				</svg>
				<form method="get" action="/trip/list">
					<input type="text" name="keyword" class="form-control" style="float: left; width: 500px; height: 35px; margin-left:10px; margin-top:10px">
					<button type="submit" class="w-20 btn btn-secondary btn-lg" style="float:left; margin: 10px 0 0 0; height: 35px; width: 80px; text-align:center; line-height:15px; font-size:15px;">검색</button>
				</form>
			</div>
			<!--  목록 정렬 -->
			<div id="orderColumnContainer">
				<a th:text="업데이트순" th:href="@{|/trip/list?region=${region}&orderColumn=writedate|}"></a>&nbsp;
				<a th:text="조회순" th:href="@{|/trip/list?region=${region}&orderColumn=hit|}"></a>&nbsp;
				<a th:text="좋아요순" th:href="@{|/trip/list?region=${region}&orderColumn=trip_liked|}"></a>
			</div>
		</div>
		
		<br>
			<!-- 관리자일 때, 임시저장 목록 보이게 -->
			<div th:if="${grade} == 'admin'" style="clear:both;">
				<a th:href="@{/trip/tripListAdmin}">임시저장 목록</a>
			</div>
		<br>
		<!-- 카드로 들어가는 정보 -->
		<div class="container" style="clear:both;">
			<div class="row row-cols-md-4">
				<div class="col-3" th:each="trip:${tripList}">
					<div class="card"
						style="width: 17rem; border: 0.75px solid #eaeaea; box-shadow: 3px 3px 4px rgba(26, 26, 26, 0.1);">
						<img th:src="@{|/images/${trip.trip_img}|}" class="card-img-top" alt="..." >
						<div class="card-body">
							<h5 class="card-title" th:text="${trip.trip_title}"></h5>
							<p class="card-text text-truncate" th:text="${trip.trip_detail}" style="max-width: 300px;"></p>
							<p class="card-text" th:text="|지역 : ${trip.region}|"></p>
							<input type="checkbox" class="tripLiked" th:value="${trip.trip_no}" th:attr="likedTitle=${trip.trip_title},likeImg=${trip.trip_img},checkLikedNo=${trip.trip_no}">
							<label for="liked">찜</label>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 페이징 -->
		<div id="page_container">
 			<div id="page">
 				<span th:if="${startPage} > 1 ">
					<a th:href="@{|/trip/list?region=${region}&orderColumn=${orderColumn}&pageNum=${startPage-1}|}" th:text="|<|"></a>
				</span>
				<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword != null } ">
					<a th:text="${page}" th:href="@{|/trip/list?keyword=${keyword}&amp;region=${region}&orderColumn=${orderColumn}&pageNum=${page}|}"></a>
				</span>
				<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword == null} ">
					<a th:text="${page}" th:href="@{|/trip/list?region=${region}&orderColumn=${orderColumn}&pageNum=${page}|}"></a>
				</span>
				<span th:if="${endPage} < ${totalPage }">
					<a id="page_num" th:href="@{|/trip/list?region=${region}&orderColumn=${orderColumn}&pageNum=${endPage+1}|}" th:text="|>|"></a>
				</span>
			</div>
		</div> 
	</article>
	<footer>
	</footer>
</body>
</html>