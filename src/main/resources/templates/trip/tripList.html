<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>여행지 목록</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script type="text/javascript">
	$(function(){
		var login = $("#login_user").val();

		// 해당 아이디가 찜한 게시물 표시
		function getUserLiked(login){
			var tripLikedNoList = new Array();
			var tripLikedNoList2 = new Array();
			
			$.ajax({
				url:"/trip/findAllTripLiked/"+login,
				success:function(tripLikedNoList){
					if(tripLikedNoList != null){
						console.log(tripLikedNoList);
						/* tripLikedNoList = tripLikedNoList; */
						console.log("찜번호리스트",tripLikedNoList);
						
						for(i=0; i<tripLikedNoList.length; i++){
							tripLikedNoList2.push(tripLikedNoList[i]);
						}
						
					}
					
					console.log("함수 밖, 찜 리스트",tripLikedNoList.length);
					
					function isSelect(no){
						re = false;
						console.log("isSelect() 동작함");
						console.log(tripLikedNoList2.length);
						for(i=0; i<tripLikedNoList2.length; i++){
							console.log("isSelect()");
							if(tripLikedNoList2[i] == no){
								console.log("isSelect 함수 안,"+tripLikedNoList2);
								re = true;
								break;
							}
						}
						return re;
					};
					
					$(".tripLiked").each(function(){
						console.log("tripLiked each 동작");
						var checkLikedNoAttr = $(this).attr("checkLikedNo");
						var checkLikedNo = $(this).val();
						console.log("isSelect()전"+checkLikedNo);
						console.log("isSelect()전"+tripLikedNoList2);
						if(isSelect(checkLikedNoAttr)){
							console.log("isSelect()후"+checkLikedNo);
							console.log("checkLikedNoAttr"+checkLikedNoAttr);
							$(this).attr("checked","checked");
						}
					});
				}
			});
		};
		
		getUserLiked(login);
		
		// 찜 기능
		$(".tripLiked").click(function(){
			if($(this).is(":checked")){
				$.ajax({
					url:"/trip/tripLiked",
					data:{
						"memberId":"admin12",
						"type":"trip",
						"no": $(this).val(),
						"likeImg":$(this).attr("likeImg"),
						"likedTitle": $(this).attr("likedTitle")
					},
					success:function(re){
						if(re == 1){
							alert("찜!!");
						}
					}
				});
			}

			if($(this).is(":checked")==false){
				$.ajax({
					url:"/trip/tripUnliked",
					data:{
						"memberId":"admin12",
						"type":"trip",
						"no": $(this).val(),
						"likeImg":$(this).attr("likeImg"),
						"likedTitle": $(this).attr("likedTitle")
					},
					success:function(re){
						if(re == 1){
							alert("찜취소!!");
						}
					}
				});
			}
		});

	});
</script>
</head>
<body>
	<h1>여행지 목록</h1>
	<hr>
	로그인한 유저 : <input type="text" name="login_user" id="login_user" value="admin12">
	<hr>
	<!-- 관리자일 때, 등록 버튼 보이게 -->
	<div th:if="${grade} == 'admin'">
		<a th:text="등록" th:href="@{|/trip/tripInsert|}"></a>
	</div>
	<hr>
	<span th:each="k:${koreaList}">
		<button th:text="${k.region}" th:value="${k.code}" 
			th:onclick="|location.href='@{|/trip/tripList?region=${k.code}|}'|"></button>
	</span>
	<hr>
	<form method="get" action="/trip/tripList">
		<input type="text" name="keyword">
		<input type="submit" value="검색">
	</form>
	<span>
		<a th:text="업데이트순" th:href="@{|/trip/tripList?region=${region}&orderColumn=writedate|}"></a>
		<a th:text="조회순" th:href="@{|/trip/tripList?region=${region}&orderColumn=hit|}"></a>
		<a th:text="좋아요순" th:href="@{|/trip/tripList?region=${region}&orderColumn=trip_liked|}"></a>
	</span>
	<hr>
	<br>
	<!-- 관리자일 때, 임시저장 목록 보이게 -->
	<div th:if="${grade} == 'admin'">
		<a th:href="@{/trip/tripListAdmin}">임시저장 목록</a>
	</div>
	<br>
	<div class="card" style="width: 18rem;" th:each="trip:${tripList}">
		<img th:src="@{|/images/${trip.trip_img}|}" class="card-img-top" alt="...">
		<div class="card-body">
			<h5 class="card-title" th:text="${trip.trip_title}">Card title</h5>
			<p class="card-text" th:text="${trip.region}">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
			<a href="#" class="btn btn-primary">Go somewhere</a>
			<input type="checkbox" class="tripLiked" th:value="${trip.trip_no}" th:attr="likedTitle=${trip.trip_title},likeImg=${trip.trip_img},checkLikedNo=${trip.trip_no}">
			<label for="liked">찜</label>
		</div>
	</div>
	<span th:each="page : ${#numbers.sequence(1,totalPage)}" th:if="${keyword != null } ">
		<a th:text="${page}" th:href="@{|/trip/tripList?keyword=${keyword}&amp;region=${region}&orderColumn=${orderColumn}&pageNum=${page}|}"></a>
	</span>
	<span th:each="page : ${#numbers.sequence(1,totalPage)}" th:if="${keyword == null} ">
		<a th:text="${page}" th:href="@{|/trip/tripList?region=${region}&orderColumn=${orderColumn}&pageNum=${page}|}"></a>
	</span>
</body>
</html>