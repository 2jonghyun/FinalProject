<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>여행계획 목록</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script type="text/javascript">
	$(function(){
		var login = $("#login_user").val();
		
		//로그인한 아이디가 찜한 게시물 표시
		function getUserLiked(login){
			var planLikedNoList = new Array();
			var planLikedNoList2 = new Array();
			
			$.ajax({
				url:"/plan/list/liked/"+login,
				success:function(planLikedNoList){
					if(planLikedNoList != null){
						//console.log(planLikedNoList);
						/* tripLikedNoList = tripLikedNoList; */
						//console.log("찜번호리스트",planLikedNoList);
						
						for(i = 0; i < planLikedNoList.length; i++){
							planLikedNoList2.push(planLikedNoList[i]);
						}
						
					}
					
					//console.log("함수 밖, 찜 리스트",planLikedNoList.length);
					
					function isSelect(no){
						re = false;
						//console.log("isSelect() 동작함");
						//console.log(planLikedNoList2.length);
						
						for(i = 0; i < planLikedNoList2.length; i++){
							//console.log("isSelect()");
							if(planLikedNoList2[i] == no){
								//console.log("isSelect 함수 안,"+planLikedNoList2);
								re = true;
								break;
							}
						}
						return re;
					};
					
					$(".planLiked").each(function(){
						//console.log("planLiked each 동작");
						var likedPlanNoAttr = $(this).attr("LikedPlanNo");
						var likedPlanNo = $(this).val();
						
						//console.log("isSelect()전"+likedPlanNo);
						//console.log("isSelect()전"+planLikedNoList2);
						
						if(isSelect(likedPlanNoAttr)){
							//console.log("isSelect()후"+likedPlanNo);
							//console.log("likedPlanNoAttr"+likedPlanNoAttr);
							$(this).attr("checked","checked");
						}
					});
				} //end success: function()
			}); //end ajax
		}; //end getUserLiked()
		
		getUserLiked(login);
		
		
		// 찜 기능
		$(".planLiked").click(function(){
			if($(this).is(":checked")){
				$.ajax({
					url:"/plan/detail/liked/insert",
					data: {
						member_id: login,
						no: $(this).attr("LikedPlanNo"),
						plan_img: $(this).attr("likedImg"),
						liked_title: $(this).attr("likedTitle")
					},
					success: function(re){
						if(re == 1){
							console.log("찜!!");
						}
					}
				});
			}

			if($(this).is(":checked") == false){
				$.ajax({
					url: "/plan/detail/liked/delete",
					data: {
						no: $(this).attr("LikedPlanNo")
					},
					success: function(re){
						if(re == 1){
							console.log("찜취소!!");
						}
					}
				});
			}
		});
		
	});
</script>
</head>
<body>
	<h2>여행계획 목록</h2>
	로그인한 유저 : <input type="text" name="login_user" id="login_user" value="hong">
	<hr>
	<a href="/plan/insert">여행계획 작성</a>
	
	<hr>
	<form action="/plan/list" method="get">
		<select id="region" name="region">
				<option value="" selected>지역선택</option>
				<option th:each="r:${regionlist}" th:text="${r.region}" th:value="${r.code}"></option>
		</select>
		<input type="search" id="keyword" name="keyword">
		<input type="submit" value="검색">
	</form>
	<hr>
	<a th:href="@{|/plan/list?orderColumn=plan_date&pageNUM=${pageNUM}|}" th:text="업데이트순"></a>&nbsp;&nbsp;
 	<a th:href="@{|/plan/list?orderColumn=plan_hit&pageNUM=${pageNUM}|}" th:text="조회순"></a>&nbsp;&nbsp;
	<a th:href="@{|/plan/list?orderColumn=plan_liked&pageNUM=${pageNUM}|}" th:text="좋아요순"></a>
	<hr>

	<table border="1" width="80%">
		<tr>
			<th>번호</th>
			<th>사진</th>
			<th>제목</th>
			<th>작성자</th>
		</tr>
			
		<tr th:each="p:${list}">
			<td th:text="${p.plan_no}"></td>
			<td th:text="${p.plan_img}"></td>
			<td>
				<a th:text="${p.plan_title}" th:href="@{'/plan/detail/'+${p.plan_no}}"></a>
			</td>
			<td th:text="${p.member_id}"></td>
		</tr>
	</table>
	
	<hr>
	
	<!-- 여행계획 목록 -->
	<div id="content">
		<div class="card" style="width: 18rem;" th:each="p:${list}">
		  <img th:src="@{|/images/${p.plan_img}|}" class="card-img-top" alt="...">
		  <div class="card-body">
		    <h5 class="card-title" th:text="${p.plan_title}">Card title</h5>
		    <input type="text" th:text="${p.plan_no}" id="plan_no">
		    <p class="card-text" th:text="${p.member_id}">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
		    <p class="card-text" th:text="지역">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
		    <a href="#" class="btn btn-primary">Go somewhere</a>
		    
		    <input type="checkbox" class="planLiked" th:value="${p.plan_no}" th:attr="likedTitle=${p.plan_title},likedImg=${p.plan_img},LikedPlanNo=${p.plan_no}">
			<label for="liked">찜</label>
		  </div>
		</div>
	
	</div>


	<!-- <span th:if="${startPage} > 1 ">
		<a th:href="@{'/plan/list/'+${startPage-1}}" th:text="<"></a>
	</span>
	&nbsp;
	<span th:each="i:${#numbers.sequence(startPage, endPage)}">
		<a th:href="@{'/plan/list/'+${i}}" th:text="${i}"></a>&nbsp;
	</span>
	&nbsp;
	<span th:if="${endPage} < ${totalPage }">
		<a th:href="@{'/plan/list/'+${endPage+1}}" th:text=">"></a>
	</span> -->
	
 	<div id="page">
	 	<span th:if="${startPage} > 1 ">
			<a th:href="@{'/plan/list/'+${startPage-1}}" th:text="<"></a>
		</span>
		<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword != null } ">
			<a th:text="${page}" th:href="@{|/plan/list?keyword=${keyword}&amp;region=${region}&orderColumn=${orderColumn}&pageNUM=${page}|}"></a>
		</span>
		<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword == null} ">
			<a th:text="${page}" th:href="@{|/plan/list?region=${region}&orderColumn=${orderColumn}&pageNUM=${page}|}"></a>
		</span>
		<span th:if="${endPage} < ${totalPage }">
			<a th:href="@{'/plan/list/'+${endPage+1}}" th:text=">"></a>
		</span>
	</div> 
	
	
</body>
</html>