<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>여행계획 목록</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<style type="text/css">
	/* 찜 */
	/* input[type=checkbox] {
   		 display:none;
   		cursor: pointer;
	}
	
	input[type=checkbox] + label { 
	    cursor: pointer;
	    padding-left: 35px; 
	    background-repeat: no-repeat;
	    background-image: url('../images/heart_default.png');
	    width: 100px;
	    height: 50px;
	}
	input[type=checkbox]:checked + label {
	    background-image: url('../images/heart_liked.png');
	}
	 */
	
	
	

	.card_link{
		text-decoration: none;
		color: black;
	}
</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script type="text/javascript">
	$(function(){
		var login = $("#login_user").val();
		
		
		//로그인한 아이디가 찜한 게시물 표시
		function getUserLiked(login){
			var planLikedNoList = new Array();
			var planLikedNoList2 = new Array();
			
			$.ajax({
				url:"/plan/list/liked/"+login,
				success:function(planLikedNoList){
					if(planLikedNoList != null){
						//console.log(planLikedNoList);
						/* tripLikedNoList = tripLikedNoList; */
						//console.log("찜번호리스트",planLikedNoList);
						
						for(i = 0; i < planLikedNoList.length; i++){
							planLikedNoList2.push(planLikedNoList[i]);
						}
						
					}
					
					//console.log("함수 밖, 찜 리스트",planLikedNoList.length);
					
					function isSelect(no){
						re = false;
						//console.log("isSelect() 동작함");
						//console.log(planLikedNoList2.length);
						
						for(i = 0; i < planLikedNoList2.length; i++){
							//console.log("isSelect()");
							if(planLikedNoList2[i] == no){
								//console.log("isSelect 함수 안,"+planLikedNoList2);
								re = true;
								break;
							}
						}
						return re;
					};
					
					$(".planLiked").each(function(){
						//console.log("planLiked each 동작");
						var likedPlanNoAttr = $(this).attr("LikedPlanNo");
						var likedPlanNo = $(this).val();
						
						//console.log("isSelect()전"+likedPlanNo);
						//console.log("isSelect()전"+planLikedNoList2);
						
						if(isSelect(likedPlanNoAttr)){
							//console.log("isSelect()후"+likedPlanNo);
							//console.log("likedPlanNoAttr"+likedPlanNoAttr);
							$(this).attr("checked","checked");
						}
					});
				} //end success: function()
			}); //end ajax
		}; //end getUserLiked()
		
		getUserLiked(login);
		
		
		// 찜 기능
		$(".planLiked").click(function(){
			if(login == ""){
				alert("로그인하세요");
				//로그인 페이지 링크 연결
				$(this).prop("checked", false);
			}else{
				if($(this).is(":checked")){
					$.ajax({
						url:"/plan/detail/liked/insert",
						data: {
							member_id: login,
							no: $(this).attr("LikedPlanNo"),
							plan_img: $(this).attr("likedImg"),
							liked_title: $(this).attr("likedTitle")
						},
						success: function(re){
							if(re == 1){
								console.log("찜!!");
							}
						}
					});
				}
	
				if($(this).is(":checked") == false){
					$.ajax({
						url: "/plan/detail/liked/delete",
						data: {
							no: $(this).attr("LikedPlanNo")
						},
						success: function(re){
							if(re == 1){
								console.log("찜취소!!");
							}
						}
					});
				}
				
			}
			
		});
		
		
		//korea_code로 region 가져오기
		$(".korea_code").each(function(){
			var korea_code = $(this).html();
			var region = "";
			//console.log("korea_code:" + korea_code);
			switch(korea_code){
				case "1": region = "서울"; $(this).html(region); break;
				case "2": region = "경기"; $(this).html(region); break;
				case "3": region = "인천"; $(this).html(region); break;
				case "4": region = "강원"; $(this).html(region); break;
				case "5": region = "충남"; $(this).html(region); break;
				case "6": region = "세종"; $(this).html(region); break;
				case "7": region = "대전"; $(this).html(region); break;
				case "8": region = "충복"; $(this).html(region); break;
				case "9": region = "경북"; $(this).html(region); break;
				case "10": region = "대구"; $(this).html(region); break;
				case "11": region = "울산"; $(this).html(region); break;
				case "12": region = "경남"; $(this).html(region); break;
				case "13": region = "부산"; $(this).html(region); break;
				case "14": region = "전북"; $(this).html(region); break;
				case "15": region = "전남"; $(this).html(region); break;
				case "16": region = "광주"; $(this).html(region); break;
				case "17": region = "제주"; $(this).html(region); break;
			}
		});
		
		
		$("#planInsert").click(function(e){
			e.preventDefault();
			if(login == ""){
				alert("로그인하세요.");
			}else{
				$("#planInsert").unbind('click').click();
			}
		});
		
		
	});
</script>
</head>
<body>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
	<h2>여행계획 목록</h2>
	로그인한 유저 : <input type="text" name="login_user" id="login_user">
	<hr>
	<a href="/plan/insert" id="planInsert">여행계획 작성</a>
	<div id="test"></div>
	
	<hr>
	<form action="/plan/list" method="get">
		<select id="region" name="region">
				<option value="" selected>지역선택</option>
				<option th:each="r:${regionlist}" th:text="${r.region}" th:value="${r.code}"></option>
		</select>
		<input type="search" id="keyword" name="keyword">
		<input type="submit" value="검색">
	</form>
	<hr>
	<div id="order_container">
		<a th:href="@{|/plan/list?orderColumn=plan_date&pageNUM=${pageNUM}&keyword=${keyword}|}" th:text="업데이트순"></a>&nbsp;&nbsp;
	 	<a th:href="@{|/plan/list?orderColumn=plan_hit&pageNUM=${pageNUM}&keyword=${keyword}|}" th:text="조회순"></a>&nbsp;&nbsp;
		<a th:href="@{|/plan/list?orderColumn=plan_liked&pageNUM=${pageNUM}&keyword=${keyword}|}" th:text="좋아요순"></a>
	</div>
	<hr>
	
	<!-- 여행계획 목록 -->
	<div id="content">
		<div class="row row-cols-md-4">
			<div class="col-3" th:each="p:${list}">
			<!-- th:onclick="|location.href='@{|/plan/detail/${p.plan_no}|}'|" -->
				<div class="card" style="width: 18rem;">
					<a th:href="@{'/plan/detail/'+${p.plan_no}}" class="card_link">
						<img th:src="@{|/images/${p.plan_img}|}" class="card-img-top" alt="...">
					</a>
					<div class="card-body">
						<a th:href="@{'/plan/detail/'+${p.plan_no}}" class="card_link">
							<h3 class="card-title" th:text="${p.plan_title}"></h3>
						</a>
						<input type="hidden" th:value="${p.plan_no}" id="plan_no">
						<p class="card-text" th:text="${p.member_id}"></p>
						<p class="card-text korea_code" th:text="${p.korea_code}"></p>

						<div id="liked">
							<input type="checkbox" class="planLiked" id="liked" th:attr="likedTitle=${p.plan_title},likedImg=${p.plan_img},LikedPlanNo=${p.plan_no}">
							<label for="liked"></label>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div> <!-- end #content -->


	<!-- <span th:if="${startPage} > 1 ">
		<a th:href="@{'/plan/list/'+${startPage-1}}" th:text="<"></a>
	</span>
	&nbsp;
	<span th:each="i:${#numbers.sequence(startPage, endPage)}">
		<a th:href="@{'/plan/list/'+${i}}" th:text="${i}"></a>&nbsp;
	</span>
	&nbsp;
	<span th:if="${endPage} < ${totalPage }">
		<a th:href="@{'/plan/list/'+${endPage+1}}" th:text=">"></a>
	</span> -->
	
 	<div id="page">
	 	<span th:if="${startPage} > 1 ">
			<a th:href="@{'/plan/list/'+${startPage-1}}" th:text="<"></a>
		</span>
		<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword != null } ">
			<a th:text="${page}" th:href="@{|/plan/list?keyword=${keyword}&amp;region=${region}&orderColumn=${orderColumn}&pageNUM=${page}|}"></a>
		</span>
		<span th:each="page : ${#numbers.sequence(startPage,endPage)}" th:if="${keyword == null} ">
			<a th:text="${page}" th:href="@{|/plan/list?region=${region}&orderColumn=${orderColumn}&pageNUM=${page}|}"></a>
		</span>
		<span th:if="${endPage} < ${totalPage }">
			<a th:href="@{'/plan/list/'+${endPage+1}}" th:text=">"></a>
		</span>
	</div> 
	
	
</body>
</html>